<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title><%= title || 'Inventory Management' %></title>
  <link rel="stylesheet" href="/css/styles.css" />
</head>
<body>
  <div class="container">
    <main class="content-box">
      <h1><%= title || 'Manage Vehicle Inventory' %></h1>

      <!-- Flash message -->
      <% if (messages?.notice) { %>
        <div class="notice"><%= messages.notice %></div>
      <% } %>

      <!-- Classification Dropdown -->
      <% if (classifications) { %>
        <form>
          <label for="classificationSelect">Filter by classification:</label>
          <select name="classification_id" id="classificationSelect" onchange="redirectToClassification(this)">
            <option value="">-- Select Classification --</option>
            <% classifications.forEach(c => { %>
              <option value="<%= c.classification_id %>" <%= c.classification_id == classification_id ? 'selected' : '' %>>
                <%= c.classification_name %>
              </option>
            <% }) %>
          </select>
        </form>
      <% } %>

      <script>
        function redirectToClassification(select) {
          const id = select.value;
          if (id) {
            window.location.href = `/inv/type/${id}`;
          }
        }
      </script>

      <hr />

      <!-- Add New Vehicle -->
      <p><a href="/inv/add-inventory" class="btn btn-primary">Add Vehicle</a></p>

      <!-- Vehicle Table -->
      <% if (inventory && inventory.length > 0) { %>
        <table class="inventory-table">
          <thead>
            <tr>
              <th>Make</th>
              <th>Model</th>
              <th>Year</th>
              <th>Price</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% inventory.forEach(vehicle => { %>
              <tr>
                <td><%= vehicle.inv_make %></td>
                <td><%= vehicle.inv_model %></td>
                <td><%= vehicle.inv_year %></td>
                <td>$<%= vehicle.inv_price.toLocaleString() %></td>
                <td>
                  <a href="/inv/edit/<%= vehicle.inv_id %>">Modify</a>
                  |
                  <form action="/inv/delete" method="post" style="display:inline;">
                    <input type="hidden" name="inv_id" value="<%= vehicle.inv_id %>">
                    <button type="submit" onclick="return confirm('Are you sure you want to delete this vehicle?');">Delete</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <p>No inventory found.</p>
      <% } %>
    </main>

    <footer>
      <p>&copy; ACME Motors</p>
    </footer>
  </div>
</body>
</html>
